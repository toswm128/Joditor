{"ast":null,"code":"import _slicedToArray from\"/Users/jominsu/Documents/GitHub/Joditor/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import useWrite from\"lib/write\";import{useCallback,useRef,useState}from\"react\";import useTags from\"./TagBox/TagList/Tags/useTags\";var useEditorInputter=function useEditorInputter(data){var _useState=useState(data.text),_useState2=_slicedToArray(_useState,2),text=_useState2[0],setText=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),drogOver=_useState4[0],setDrogOver=_useState4[1];var inputterRef=useRef(null);var spaceFlag=useRef(false);var _useWrite=useWrite(),setLineText=_useWrite.setLineText,focusNextLine=_useWrite.focusNextLine,focusPrevLine=_useWrite.focusPrevLine,setTag2Ul=_useWrite.setTag2Ul,removeLine=_useWrite.removeLine,removeLineOnly=_useWrite.removeLineOnly,setTag2A=_useWrite.setTag2A,redo=_useWrite.redo,undo=_useWrite.undo,dropImg=_useWrite.dropImg,setImg=_useWrite.setImg,searchTag=_useWrite.searchTag,enterInputter=_useWrite.enterInputter,clickInputter=_useWrite.clickInputter,openTagBox=_useWrite.openTagBox,closeTagBox=_useWrite.closeTagBox,focusNextTag=_useWrite.focusNextTag,focusPrevTag=_useWrite.focusPrevTag,focusSetUpTag=_useWrite.focusSetUpTag,WriteEditorState=_useWrite.WriteEditorState;var _useTags=useTags(),selectTagId=_useTags.selectTagId;var onChangeText=function onChangeText(e,id){if(e.target.value.startsWith(\"/\")){openTagBox(id);searchTag(e.target.value.substring(1));}else if(WriteEditorState.tagBoxId)closeTagBox();setText(e.target.value);};var clickTagButton=function clickTagButton(){click();WriteEditorState.tagBoxId!==null?closeTagBox():openTagBox(data.id);};var onKeyPressEnter=useCallback(function(e){if(e.key===\"Enter\"&&e.shiftKey===false){if(WriteEditorState.tagBoxFocusIdx!==null){selectTagId();focusSetUpTag();}else{setLineText(text,data.id);enterInputter(data.id,data.next);}e.preventDefault();}},[data.id,data.next,enterInputter,selectTagId,WriteEditorState.tagBoxFocusIdx,focusSetUpTag,setLineText,text]);var onKeyDownArrowUp=useCallback(function(e){e.preventDefault();if(inputterRef.current&&!e.nativeEvent.isComposing){if(WriteEditorState.tagBoxId!==null){focusPrevTag();console.log(WriteEditorState.tagBoxId);}else focusPrevLine(data.id,inputterRef.current.selectionEnd);}},[data.id,focusPrevLine,focusPrevTag,WriteEditorState.tagBoxId]);var onKeyDownArrowDown=useCallback(function(e){e.preventDefault();if(inputterRef.current&&!e.nativeEvent.isComposing){if(WriteEditorState.tagBoxId!==null){focusNextTag();}else focusNextLine(data.id,inputterRef.current.selectionEnd);}},[data.id,focusNextLine,focusNextTag,WriteEditorState.tagBoxId]);var onKeyDownSpace=useCallback(function(){if(inputterRef.current){setLineText(text,data.id,inputterRef.current.selectionEnd);spaceFlag.current=true;}},[data.id,setLineText,text]);var onKeyDownTab=useCallback(function(e){e.preventDefault();if(data.tag!==\"ul\"){inputterRef.current&&setTag2Ul(data.id,inputterRef.current.selectionEnd);}},[data.id,data.tag,setTag2Ul]);var onKeyDownBackspace=useCallback(function(){if(data.next!==null||WriteEditorState.head!==data.id){if(text.length===0)removeLine(data.id,data.next,data.prev);else if(inputterRef.current&&inputterRef.current.selectionEnd+inputterRef.current.selectionStart===0){removeLineOnly(data.id,data.next,data.prev);}else{spaceFlag.current&&setLineText(text,data.id);spaceFlag.current=false;}}},[data.id,data.next,data.prev,removeLine,removeLineOnly,setLineText,WriteEditorState.head,text]);var onKeyDownZ=useCallback(function(e){if(e.metaKey===true||e.ctrlKey===true){if(!e.nativeEvent.isComposing){e.preventDefault();if(e.shiftKey===true){redo();}else{text!==data.text&&setLineText(text,data.id);undo();}}}},[data.text,data.id,redo,undo,text,setLineText]);var onDropUrl=useCallback(function(e){e.preventDefault();setDrogOver(false);if(e.dataTransfer.files[0]!==undefined){// dropImg(data.id, URL.createObjectURL(e.dataTransfer.files[0]), true);\n}else if(e.dataTransfer.getData(\"url\")!==undefined){console.log(e.dataTransfer.types,e.dataTransfer.getData(\"url\"));// dropImg(data.id, e.dataTransfer.getData(\"url\"), true);\n}},[data.id]);var onBlur=useCallback(function(e){if(text!==data.text)setLineText(text,data.id);if(!(WriteEditorState.tagBoxId===null)&&e.currentTarget.nextSibling){!e.currentTarget.nextSibling.contains(e.relatedTarget)&&closeTagBox();}},[data.text,data.id,text,WriteEditorState.tagBoxId]);var dragOver=useCallback(function(){setDrogOver(true);},[]);var dragLeave=useCallback(function(){setDrogOver(false);},[]);var onPasteImg=useCallback(function(e){e.clipboardData.items[0]&&e.clipboardData.items[0].getAsString(function(string){if(string.startsWith(\"http\")){setLineText(string,data.id);setTag2A(data.id);}});// e.clipboardData.files[0] &&\n//   setImg(data.id, URL.createObjectURL(e.clipboardData.files[0]));\n},[data.id,setLineText,setTag2A]);var click=useCallback(function(){clickInputter(data.id);},[data.id]);return{onChangeText:onChangeText,clickTagButton:clickTagButton,onKeyPressEnter:onKeyPressEnter,onKeyDownArrowUp:onKeyDownArrowUp,onKeyDownArrowDown:onKeyDownArrowDown,onKeyDownSpace:onKeyDownSpace,onKeyDownTab:onKeyDownTab,onKeyDownBackspace:onKeyDownBackspace,onKeyDownZ:onKeyDownZ,onDropUrl:onDropUrl,onBlur:onBlur,dragOver:dragOver,dragLeave:dragLeave,onPasteImg:onPasteImg,click:click,inputterRef:inputterRef,text:text,drogOver:drogOver};};export default useEditorInputter;","map":{"version":3,"sources":["/Users/jominsu/Documents/GitHub/Joditor/src/lib/components/Write/WriteEditor/EditorInputter/useEditorInputter.ts"],"names":["useWrite","useCallback","useRef","useState","useTags","useEditorInputter","data","text","setText","drogOver","setDrogOver","inputterRef","spaceFlag","setLineText","focusNextLine","focusPrevLine","setTag2Ul","removeLine","removeLineOnly","setTag2A","redo","undo","dropImg","setImg","searchTag","enterInputter","clickInputter","openTagBox","closeTagBox","focusNextTag","focusPrevTag","focusSetUpTag","WriteEditorState","selectTagId","onChangeText","e","id","target","value","startsWith","substring","tagBoxId","clickTagButton","click","onKeyPressEnter","key","shiftKey","tagBoxFocusIdx","next","preventDefault","onKeyDownArrowUp","current","nativeEvent","isComposing","console","log","selectionEnd","onKeyDownArrowDown","onKeyDownSpace","onKeyDownTab","tag","onKeyDownBackspace","head","length","prev","selectionStart","onKeyDownZ","metaKey","ctrlKey","onDropUrl","dataTransfer","files","undefined","getData","types","onBlur","currentTarget","nextSibling","contains","relatedTarget","dragOver","dragLeave","onPasteImg","clipboardData","items","getAsString","string"],"mappings":"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","sourcesContent":["import useWrite from \"lib/write\";\nimport React, { useCallback, useRef, useState } from \"react\";\nimport { line } from \"lib/Store/WriteEditorStore/type\";\nimport useTags from \"./TagBox/TagList/Tags/useTags\";\n\nconst useEditorInputter = (data: line) => {\n  const [text, setText] = useState(data.text);\n  const [drogOver, setDrogOver] = useState(false);\n\n  const inputterRef = useRef<HTMLTextAreaElement>(null);\n  const spaceFlag = useRef<boolean>(false);\n\n  const {\n    setLineText,\n    focusNextLine,\n    focusPrevLine,\n    setTag2Ul,\n    removeLine,\n    removeLineOnly,\n    setTag2A,\n    redo,\n    undo,\n    dropImg,\n    setImg,\n    searchTag,\n    enterInputter,\n    clickInputter,\n    openTagBox,\n    closeTagBox,\n    focusNextTag,\n    focusPrevTag,\n    focusSetUpTag,\n    WriteEditorState,\n  } = useWrite();\n  const { selectTagId } = useTags();\n\n  const onChangeText = (\n    e: React.ChangeEvent<HTMLTextAreaElement>,\n    id: number\n  ) => {\n    if (e.target.value.startsWith(\"/\")) {\n      openTagBox(id);\n      searchTag(e.target.value.substring(1));\n    } else if (WriteEditorState.tagBoxId) closeTagBox();\n    setText(e.target.value);\n  };\n\n  const clickTagButton = () => {\n    click();\n    WriteEditorState.tagBoxId !== null ? closeTagBox() : openTagBox(data.id);\n  };\n\n  const onKeyPressEnter = useCallback(\n    (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n      if (e.key === \"Enter\" && e.shiftKey === false) {\n        if (WriteEditorState.tagBoxFocusIdx !== null) {\n          selectTagId();\n          focusSetUpTag();\n        } else {\n          setLineText(text, data.id);\n          enterInputter(data.id, data.next);\n        }\n        e.preventDefault();\n      }\n    },\n    [\n      data.id,\n      data.next,\n      enterInputter,\n      selectTagId,\n      WriteEditorState.tagBoxFocusIdx,\n      focusSetUpTag,\n      setLineText,\n      text,\n    ]\n  );\n\n  const onKeyDownArrowUp = useCallback(\n    (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n      e.preventDefault();\n      if (inputterRef.current && !e.nativeEvent.isComposing) {\n        if (WriteEditorState.tagBoxId !== null) {\n          focusPrevTag();\n          console.log(WriteEditorState.tagBoxId);\n        } else focusPrevLine(data.id, inputterRef.current.selectionEnd);\n      }\n    },\n    [data.id, focusPrevLine, focusPrevTag, WriteEditorState.tagBoxId]\n  );\n\n  const onKeyDownArrowDown = useCallback(\n    (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n      e.preventDefault();\n      if (inputterRef.current && !e.nativeEvent.isComposing) {\n        if (WriteEditorState.tagBoxId !== null) {\n          focusNextTag();\n        } else focusNextLine(data.id, inputterRef.current.selectionEnd);\n      }\n    },\n    [data.id, focusNextLine, focusNextTag, WriteEditorState.tagBoxId]\n  );\n\n  const onKeyDownSpace = useCallback(() => {\n    if (inputterRef.current) {\n      setLineText(text, data.id, inputterRef.current.selectionEnd);\n      spaceFlag.current = true;\n    }\n  }, [data.id, setLineText, text]);\n\n  const onKeyDownTab = useCallback(\n    (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n      e.preventDefault();\n      if (data.tag !== \"ul\") {\n        inputterRef.current &&\n          setTag2Ul(data.id, inputterRef.current.selectionEnd);\n      }\n    },\n    [data.id, data.tag, setTag2Ul]\n  );\n\n  const onKeyDownBackspace = useCallback(() => {\n    if (data.next !== null || WriteEditorState.head !== data.id) {\n      if (text.length === 0) removeLine(data.id, data.next, data.prev);\n      else if (\n        inputterRef.current &&\n        inputterRef.current.selectionEnd +\n          inputterRef.current.selectionStart ===\n          0\n      ) {\n        removeLineOnly(data.id, data.next, data.prev);\n      } else {\n        spaceFlag.current && setLineText(text, data.id);\n        spaceFlag.current = false;\n      }\n    }\n  }, [\n    data.id,\n    data.next,\n    data.prev,\n    removeLine,\n    removeLineOnly,\n    setLineText,\n    WriteEditorState.head,\n    text,\n  ]);\n\n  const onKeyDownZ = useCallback(\n    (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n      if (e.metaKey === true || e.ctrlKey === true) {\n        if (!e.nativeEvent.isComposing) {\n          e.preventDefault();\n          if (e.shiftKey === true) {\n            redo();\n          } else {\n            text !== data.text && setLineText(text, data.id);\n            undo();\n          }\n        }\n      }\n    },\n    [data.text, data.id, redo, undo, text, setLineText]\n  );\n\n  const onDropUrl = useCallback(\n    (e: React.DragEvent<HTMLTextAreaElement>) => {\n      e.preventDefault();\n      setDrogOver(false);\n      if (e.dataTransfer.files[0] !== undefined) {\n        // dropImg(data.id, URL.createObjectURL(e.dataTransfer.files[0]), true);\n      } else if (e.dataTransfer.getData(\"url\") !== undefined) {\n        console.log(e.dataTransfer.types, e.dataTransfer.getData(\"url\"));\n        // dropImg(data.id, e.dataTransfer.getData(\"url\"), true);\n      }\n    },\n    [data.id]\n  );\n\n  const onBlur = useCallback(\n    (e: React.FocusEvent<HTMLTextAreaElement, Element>) => {\n      if (text !== data.text) setLineText(text, data.id);\n      if (\n        !(WriteEditorState.tagBoxId === null) &&\n        e.currentTarget.nextSibling\n      ) {\n        !e.currentTarget.nextSibling.contains(e.relatedTarget) && closeTagBox();\n      }\n    },\n    [data.text, data.id, text, WriteEditorState.tagBoxId]\n  );\n\n  const dragOver = useCallback(() => {\n    setDrogOver(true);\n  }, []);\n\n  const dragLeave = useCallback(() => {\n    setDrogOver(false);\n  }, []);\n\n  const onPasteImg = useCallback(\n    (e: React.ClipboardEvent<HTMLTextAreaElement>) => {\n      e.clipboardData.items[0] &&\n        e.clipboardData.items[0].getAsString((string) => {\n          if (string.startsWith(\"http\")) {\n            setLineText(string, data.id);\n            setTag2A(data.id);\n          }\n        });\n      // e.clipboardData.files[0] &&\n      //   setImg(data.id, URL.createObjectURL(e.clipboardData.files[0]));\n    },\n    [data.id, setLineText, setTag2A]\n  );\n\n  const click = useCallback(() => {\n    clickInputter(data.id);\n  }, [data.id]);\n\n  return {\n    onChangeText,\n    clickTagButton,\n    onKeyPressEnter,\n    onKeyDownArrowUp,\n    onKeyDownArrowDown,\n    onKeyDownSpace,\n    onKeyDownTab,\n    onKeyDownBackspace,\n    onKeyDownZ,\n    onDropUrl,\n    onBlur,\n    dragOver,\n    dragLeave,\n    onPasteImg,\n    click,\n    inputterRef,\n    text,\n    drogOver,\n  };\n};\n\nexport default useEditorInputter;\n"]},"metadata":{},"sourceType":"module"}